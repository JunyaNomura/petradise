<% if current_user.pet %>
  <div class="cards-category-index">
    <div class="swiper-container animated zoomIn faster">
      <div class="swiper-wrapper">
        <%@pets.each do |pet|%>
          <div class="swiper-slide find-me" data-hash=<%= pet.user.id %> >
            <div class="card-product-picture">
              <div class="photo-slideshow">
                <div class="swiper-wrapper">
                  <% if pet.photos.attached? %>
                    <%  pet.photos.each do |photo|%>
                      <div class="swiper-slide" >
                        <%= cl_image_tag(photo.key, class: "picture-dog", width: 1000, height: 1000, crop: :fill) %>
                      </div>
                    <% end %>
                  <% end %>
                </div>
              </div>
              <div class="card-product-value">
                <p><%= current_user.pet.compatibilty(pet) %>%</p>
              </div>
              <div class="card-product-picture-info-name">
                <p> <%= pet.name %> </p>
              </div>
              <div class="dog-rating">
                <% if pet.rating.blank? %>
                  <p><%= pet.rating %>  </p>
                <% else %>
                  <p><% (pet.rating).times do %>
                      <i class="fas fa-star"></i>
                    <% end %>
                    <% (5 - pet.rating).times do %>
                      <i class="far fa-star"></i>
                    <% end %></p>
                <% end %>
              </div>
              <!-- <div class="button-expand btn btn-primary" style="position: absolute; bottom: 10px; right: 10px;">Expand</div> -->
              <%= link_to "#", class: "button-expand", id: "button-index-expand" do %>
                <i class="fas fa-info-circle"></i>
              <% end %>
            </div>
            <div class="card-information-dog">
              <div class="card-information-dog-persnpref">
                <div class="card-information-dog-namenbreed">
                  <p><strong><%= pet.breed %></strong></p>
                  <p><strong><%= pet.age %></strong>
                    <% if pet.gender == "male" %>
                      <i class="fas fa-mars"></i>
                    <% else %>
                      <i class="fas fa-venus"></i>
                    <% end %>
                  </p>
                </div>
                <div class="card-information-dog-personalities">
                  <p><strong>Personality</strong></p>
                  <p><%= pet.personality_list %></p>
                </div>
                <div class="card-information-dog-preferences">
                  <p><strong>Preferences</strong></p>
                  <p><%= pet.preference_list %></p>
                </div>
              </div>
              <div class="card-information-dog-description">
                <p><strong>Description</strong></p>
                <p> <%= pet.description %>  </p>
                <%= link_to "", reject_url(pet.user), remote:true, style: "display: none", id: "reject-link" %>
                <%= link_to "", accept_path(pet.user), remote: true, style: "display: none", id: "accept-link" %>
              </div>
              <div class="show-all-reviews">
                <p><strong>Show all reviews</strong></p>
                <p>Owner Name:</p>
                <p>
                  <%= current_user.first_name %>
                  <%= current_user.last_name %>
                </p>
                <% if pet.ratings.any? %>
                  <div class="first-reviews">
                    <% pet.ratings.first(5).each do |rating| %>
                      <p>Ratings:</p>
                      <p><% (pet.rating).times do %>
                          <i class="fas fa-star"></i>
                        <% end %>
                        <% (5 - pet.rating).times do %>
                          <i class="far fa-star"></i>
                        <% end %>
                      </p>
                      <p>Comments:</p>
                      <p><%= rating.comments %></p>
                    <% end %>
                  </div>
                  <div class="show-all-button button-chat" id="button-chat-margin">
                    Show all reviews
                  </div>
                  <div class="remaining-reviews hidden">
                    <% pet.ratings.last(pet.ratings.count-5).each do |rating| %>
                      <p>Ratings:</p>
                      <p><% (pet.rating).times do %>
                          <i class="fas fa-star"></i>
                        <% end %>
                        <% (5 - pet.rating).times do %>
                          <i class="far fa-star"></i>
                        <% end %>
                      </p>
                      <p>Comments:</p>
                      <p><%= rating.comments %></p>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
  </div>

</div>


<!-- <button id="sweet-alert-matched" class="btn btn-primary">Matched</button> -->
<button id="sweet-alert-matched" class="btn-transparent">Matched</button>

<!-- <div class="btn-group d-flex justify-content-between">
  <button type="button" class="btn-transparent" id="btn-nope"><img src="https://res.cloudinary.com/diyszwqhl/image/upload/v1583922785/nope_btn_qz1lsu.png"/><%#= link_to "Nope", reject_path(@pets.first.user) %></button>
  <button type="button" class="btn-transparent" id="btn-like"><img src="https://res.cloudinary.com/diyszwqhl/image/upload/v1583922798/like_btn_jnyyno.png"/><%#= link_to "Like", accept_path(@pets.first.user) %></button>
</div> -->
  <button type="button" class="btn-transparent" id="btn-my-friend"><%= link_to "friend", friends_path(@pets.first.user) %></button>



<% else %>
  <%= render 'shared/create_pet' %>
<% end %>

<script>
  // var mySwiper = new Swiper('.swiper-container', {
  //   init: true,
  //   speed: 500,
  //   loop: false,
  //   spaceBetween: 100,
  //   autoHeight: true, //enable auto height
  //   freeModeMomentum: false, // slide will keep moving for a while after you release it
  //   on: {

  //     init () {
  //       console.log('swiper initialized');
  //     },

      // slideChange () {
      //   if ( mySwiper.activeIndex > mySwiper.previousIndex ) {
      //     console.log('swipe to the left');
      //     window.location.href = '<%= reject_path(@pets.first.user) %>';
      //   } else {
      //     console.log('swipe to the right');
      //     <%# if @pets.first.user.match?(current_user) %>
      //       document.querySelector('#sweet-alert-matched').click();
      //     <%# else %>
      //       window.location.href = '<%= accept_path(@pets.first.user) %>';
      //     <%# end %>
      //   }
      // }
  //   }
  // });

  var mySwiper = new Swiper('.swiper-container', {
      // hashNavigation: true,
      init: true,
      speed: 450,
      loop: false,
      // simulateTouch: true,
      // touchAngle: 45,
      // effect: 'cube',
      // cubeEffect: {
      //     slideShadows: false,
      //   },
      spaceBetween: 100,
      autoHeight: true, //enable auto height
      pagination: {
        el: '.swiper-pagination',
        clickable: false,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      on: {
        init () {
          console.log('swiper initialized');
          console.log('activeIndex init', this.activeIndex)
          console.log('hash', document.querySelector(".find-me.swiper-slide-active").dataset.hash)
          // this.prependSlide('<div class="swiper-slide">Slide 0"</div>');
        },
        // slideChange () {
        //   const selected = document.querySelector(".swiper-slide-active");
        //   // console.log('hash2', parseInt(selected.dataset.hash));
        //   console.log('activeIndex active', this.activeIndex)

        // },
        // slidePrevTransitionStart() {
        //   console.log('yeah')
        //   this.prependSlide('<div class="swiper-slide">Slide 0"</div>');
        // },
        slidePrevTransitionEnd () {
          // console.log(this.translate());
          console.log('transition accept end') // accept request
          const selected = document.querySelector(".find-me.swiper-slide-active");
          const dogCard = document.querySelector(`[data-hash="${selected.dataset.hash}"]`);

          console.log('dogCard accept', dogCard)

          const requestedFriends = <%= raw current_user.requested_friends.map(&:id) %>
          console.log(requestedFriends)
          // this.update();
          <%# if @pets.first.user.match?(current_user) %>
          // this.slidePrev(500, () => {
            if (requestedFriends.includes(selected.dataset.hash)) {
                dogCard.querySelector('#accept-link').click();
                document.querySelector('#sweet-alert-matched').click();
                // this.slideNext(500, false);
            } else {
                dogCard.querySelector('#accept-link').click();
                // this.slideNext(500, false);
                console.log('activeIndex', this.activeIndex)
            }
            this.removeSlide(this.activeIndex)
            this.removeSlide(this.activeIndex)
            this.update();
            // this.slideTo(this.activeIndex + 1, 1000, false);
            // this.removeSlide(this.previousIndex);
          // })
        },
        slideNextTransitionEnd() {
          console.log('transition reject end')// reject request
          const selected = document.querySelector(".find-me.swiper-slide-active");
          const dogCard = document.querySelector(`[data-hash="${selected.dataset.hash}"]`);

          console.log('hash',selected)
          console.log('dogCard reject', dogCard)
          dogCard.querySelector('#reject-link').click();
          console.log(this.activeIndex, this.previousIndex)
          // console.log('remove stuff', this.previousIndex);
          if(this.previousIndex !== 0) {
            this.removeSlide(this.previousIndex - 1);
            this.update();
          }

          // this.removeSlide(this.previousIndex - 1);
        }
      }
    });

  // mySwiper.init();

  var photoSlideShow = new Swiper('.photo-slideshow', {
    init: true,
    speed: 250,
    loop: false,
    spaceBetween: 0,
    autoHeight: true, //enable auto height
    // allowTouchMove: false,
    direction: 'vertical',
    // wrapperClass: 'slideshow-wrapper',
    // pagination: {
    //   el: '.swiper-pagination',
    //   clickable: true,
    // },
    // navigation: {
    //   nextEl: '.swiper-button-next',
    //   prevEl: '.swiper-button-prev',
    // }
  });

  // photoSlideShow.init();
  // var mySwiper2 = document.querySelector('.swiper-container').swiper
    // var mySwiper2 = document.querySelector('.swiper-container').swiper
  document.querySelectorAll(".button-expand").forEach(button => {

  button.addEventListener("click", (event) => {
  document.querySelector("body").classList.toggle("expanded")
  document.querySelector("body").classList.toggle("non-scroll")
  });
  })

  document.querySelector('.show-all-button').addEventListener('click', () => {
  document.querySelector('.remaining-reviews').classList.remove('hidden')
  document.querySelector('.show-all-button').remove()
  })
</script>
